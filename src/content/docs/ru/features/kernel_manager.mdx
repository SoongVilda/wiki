---
title: Управление ядрами Linux и фреймворком sched-ext с помощью CachyOS Kernel Manager
description: CachyOS Kernel Manager — это мощный инструмент для управления ядрами, позволяющий пользователям с лёгкостью устанавливать или собирать пользовательские ядра.
---

import ImageComponent from '~/components/image-component.astro';

Установка ядра из репозитория
---------------------------------------

**CachyOS Kernel Manager упрощает установку и управление ядрами из любого репозитория Arch Linux.**

Чтобы установить ядро, запустите приложение `CachyOS Kernel Manager` и выберите желаемое ядро, отметив галочкой поле `[]` в списке всех доступных вариантов, затем просто нажмите `Execute`, чтобы начать установку.

<br />
<ImageComponent imgsrc={import('~/assets/images/cachyos-km1.png')} />

:::note
Кнопка `Execute` становится недоступной, если вы выбираете уже установленное ядро.
:::

Конфигурирование и сборка пользовательского ядра CachyOS
---------------------------------

<br />
<ImageComponent imgsrc={import('~/assets/images/cachyos-km2.png')} />

**CachyOS Kernel Manager позволяет легко настраивать и собирать пользовательское ядро CachyOS.**

:::note
CachyOS Kernel Manager специально разработан для сборки пользовательских ядер **вариантов CachyOS** и не поддерживает сборку или настройку стандартного ядра Arch Linux или любого другого варианта.
:::

*Для начала откройте Kernel Manager и нажмите кнопку `Configure`, чтобы начать настройку различных параметров, таких как желаемый планировщик, частота тактов и многое другое. После внесения желаемых изменений нажмите кнопку `Build kernel`, чтобы начать сборку вашего пользовательского ядра CachyOS.*

**Доступные параметры конфигурации:**

* *`Custom package name`: **С помощью этой опции вы можете назвать своё ядро как угодно, например: `linux-custom-cachy`***
* *Планировщик (BORE, RC, RT, RT+BORE, EEVDF и BMQ)*
* *Включить конфигурацию CachyOS*
* *Тонкая настройка конфигурации через nconfig, menuconfig, xconfig или gconfig*
* *Включить/выключить NUMA*
* *Включить/выключить Modprobed-db*
* *Флаги KBUILD CFLAGS (-O3 или -O2)*
* *Регулятор производительности по умолчанию*
* *Включить BBR3*
* *Выбор частоты тактов (100Гц, 250Гц, 300Гц, 500Гц, 600Гц, 750Гц, 1000Гц)*
* *Безтиковый режим (idle, periodic, full)*
* *Вытеснение (полное, добровольное или серверное)*
* *Прозрачные огромные страницы (всегда или с подсказкой)*
* *Включить/выключить DAMON*
* *Включить/выключить автоматическое определение архитектуры ЦП*
* *Применить оптимизацию ядра для конкретных архитектур ЦП*
* *Включить LTO (полное, тонкое, нет)*
* *Собрать модуль ZFS*
* *Собрать закрытый модуль NVIDIA*
* *Собрать открытый модуль NVIDIA*
* *Включить vmlinux с отладочной информацией/символами*
* *Загрузить/сохранить пресет конфигурации Kernel Manager: `(только пресеты из самого менеджера)`*
* *Управление патчами ядра (поддержка удалённых и локальных)*

**После успешной сборки ядра вам будет предложено ввести пароль sudo для его установки.**

## Управление фреймворком Sched-ext

**Kernel Manager предоставляет графический пользовательский интерфейс (GUI) для управления и контроля планировщиков sched-ext. Чтобы получить доступ к GUI, нажмите кнопку `sched-ext scheduler config` в главном окне.**

<br />
<ImageComponent imgsrc={import('~/assets/images/cachyos-km3.png')} />

Этот GUI позволяет:

- **Переключаться между различными планировщиками sched-ext (scx).**
- **Включать или отключать службу планировщика.**
- **Проверять текущий работающий планировщик.**
- **Устанавливать флаги и профили планировщика. `В настоящее время профили поддерживаются только bpfland и lavd.`**

Для этого Kernel Manager использует `scx_loader` с конфигурацией, хранящейся в:

`/etc/scx_loader.toml`. Для получения дополнительной информации о файле конфигурации `scx_loader` ознакомьтесь с [этой документацией](https://github.com/sched-ext/scx/blob/main/rust/scx_loader/configuration.md).

- **Как работает `scx_loader`?**
    - После выбора планировщика и профиля `scx_loader` запустит планировщик с выбранным профилем и сохранит эту конфигурацию в файл `/etc/scx_loader.toml`, чтобы обеспечить её сохранение после перезагрузки. Пример того, как будет выглядеть файл при выборе `scx_bpfland` с профилем `Gaming`:
        ```toml
        default_sched = "scx_bpfland"
        default_mode = "Gaming"

        [scheds.scx_bpfland]
        auto_mode = []
        gaming_mode = ["-m", "performance"]
        lowlatency_mode = ["-k", "-s", "5000", "-l", "5000"]
        powersave_mode = ["-m", "powersave"]
        ```

### Профили планировщика

- **Для чего нужны "профили"?**
  - Это пресеты для планировщика, которые изменяют флаги на основе проверенных комбинаций для повышения эффективности в конкретных сценариях использования, таких как "Игры".

**Для более детального обзора смотрите таблицу.**

#### Bpfland

|    Название профиля   	|  Флаги командной строки  	|                                                         Описание                                                         	|
|:-----------------------:	|:------------------------:	|:---------------------------------------------------------------------------------------------------------------------------:	|
| **Низкая задержка** 	| `-s 5000 -S 500 -l 5000 -m performance` 	| Предназначен для снижения задержки за счёт пропускной способности. Подходит для приложений мягкого реального времени, таких как обработка звука и мультимедиа. 	|
| **Игровой**      	| `-m performance`  	| Оптимизирует стабильность производительности в играх на системах с гибридными ядрами. Приоритезирует P-ядра над E-ядрами на процессорах Intel и CCD на процессорах Ryzen X3D.         	|
| **Энергосбережение**  	| `-m powersave`       	| Приоритезирует энергоэффективность. Предпочитает менее производительные ядра (например, E-ядра на Intel).                                          	|
| **Серверный**        | `-p`                | Приоритезирует задачи со строгой привязкой; эта опция может увеличить пропускную способность за счёт задержки и больше подходит для серверных нагрузок.

#### Flash

|   Название профиля     |  Флаги командной строки   |                                                         Описание                                                           |
|:---------------:  |:--------------------: |:---------------------------------------------------------------------------------------------------------------------------:  |
| **Низкая задержка**   | `-m performance -w -C 0`   | Предназначен для снижения задержки за счёт пропускной способности. Подходит для приложений мягкого реального времени, таких как обработка звука и мультимедиа.   |
| **Игровой**        | `-m all`      | Оптимизирует для высокой производительности в играх.           |
| **Энергосбережение**    | `-m powersave -I 10000 -t 10000 -s 10000 -S 1000`        | Приоритезирует энергоэффективность. Предпочитает менее производительные ядра (например, E-ядра на Intel) и вводит принудительный цикл простоя каждые 10 мс для увеличения энергосбережения. 
                                            |
| **Серверный**        | `-m all -s 20000 -S 1000 -I -1 -D -L`                | Настроен для серверных нагрузок. Увеличивает пропускную способность в ущерб отзывчивости.

#### LAVD

|       Название профиля       	| Флаги командной строки 	|                                                             Описание                                                            	|
|:------------------------:	|:------------------:	|:----------------------------------------------------------------------------------------------------------------------------------:	|
| **Игровой и низкая задержка** 	|   `--performance`  	| Максимизирует производительность, используя все доступные ядра и отдавая приоритет физическим ядрам.                                                   	|
|      **Энергосбережение**      	|    `--powersave`   	| Минимизирует энергопотребление, сохраняя приемлемую производительность. Приоритезирует эффективные ядра и потоки над физическими ядрами. 	|

#### P2DQ

|       Название профиля        | Флаги командной строки    |                                                             Описание                                                               |
|:------------------------: |:------------------:   |:----------------------------------------------------------------------------------------------------------------------------------:   |
| **Низкая задержка**  |   `-y`     | Снижает задержку, заставляя интерактивные задачи с большей вероятностью оставаться на том ЦП, к которому они были привязаны.                                                     |
|      **Серверный**       |    `--keep-running`      | Улучшает производительность серверных нагрузок, позволяя задачам выполняться дольше своего кванта времени, если ЦП простаивает.    |

#### Tickless

|   Название профиля    |  Флаги командной строки   |                                                         Описание                                                           |
|:---------------:  |:--------------------: |:---------------------------------------------------------------------------------------------------------------------------:  |
| **Игровой**   | `-f 5000 -s 5000`   | Повышает производительность в играх за счёт более частого обнаружения конкуренции за ЦП и переключения контекста с более коротким квантом времени.    |
| **Энергосбережение**        | `-f 50 -p`      | Повышает энергоэффективность за счёт снижения частоты проверок на конкуренцию и агрессивной попытки удержать задачи на одном и том же ЦП.          |
| **Низкая задержка**    | `-f 5000 -s 1000`        | Похож на игровой профиль, но с ещё более коротким квантом времени.                                            |
| **Серверный**        | `-f 100`                | Снижает частоту проверок на конкуренцию за ЦП для улучшения пропускной способности в ущерб отзывчивости.
