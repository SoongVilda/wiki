---
title: Laptop mit Dual-GPU-Setup-Anleitung
---

import ImageComponent from '~/components/image-component.astro';

## Was ist Hybridgrafik?

Hybridgrafik ist eine Hardwarekonfiguration, bei der du zwei Grafikkarten hast,
die zusammenarbeiten können. Dieser Ansatz findet sich hauptsächlich in Laptops,
wo du eine integrierte Grafikkarte (iGPU) deiner CPU und eine dedizierte
Grafikkarte (dGPU) hast. Der Hauptvorteil ist, dass die integrierte Grafikkarte
(aber nicht unbedingt) nur für wenig anspruchsvolle Aufgaben verwendet werden
sollte, wie z. B. im Internet surfen, Videos ansehen usw. Andererseits wird die
dedizierte Grafikkarte für leistungsintensive Dinge wie Gaming, Videobearbeitung,
3D-Modellierung usw. verwendet. Wenn sich also zwei GPUs "große" und "kleine"
Aufgaben teilen, dann brauchen wir unsere dGPU nicht zu verwenden, wenn wir im
Moment nur "kleine" Aufgaben ausführen, sodass sie einfach deaktiviert werden
kann (als ob sie schläft), wodurch der Stromverbrauch erheblich reduziert wird.
Auf diese Weise wird unsere dGPU wieder benötigt (wir führen eine Anwendung mit
ihr aus), sie aufwachen und mit der Arbeit beginnen.

## Was ist PRIME Offload?

PRIME ist eine vereinheitlichende Technologie für die Arbeit mit verschiedenen
Arten von Hybridgrafiken in Linux, wie NVIDIA Optimus/AMD Dynamic Switchable
Graphics. PRIME Offload ist eine Implementierung der Idee, die Ausführung des
Renderings von einer GPU auf eine andere in Linux zu verlagern. Die
PRIME-Unterstützung in einem geschlossenen NVIDIA-Treiber begann tatsächlich erst
mit dem Treiber 435.17. Wenn du also ein Benutzer der veralteten 390xx- oder
sogar 340xx-Treiberzweige bist, funktioniert PRIME Offload für dich nicht.
Beachte, dass wir dir auch dringend davon abraten, veraltete Methoden zur
Verwaltung von Hybridgrafiken zu verwenden, wie z. B. nvidia-xrun oder
Bumblebee. Sie sind veraltet und werden nicht unterstützt (Bumblebee wurde seit
über 8 Jahren nicht mehr aktualisiert), basieren ausschließlich auf Hacks und
haben eine geringe Leistung. Gleichzeitig unterstützt der Nouveau-Treiber PRIME
Offload, was eine Alternative für ältere dGPUs sein kann.

In CachyOS **musst du nichts konfigurieren, damit PRIME Offload funktioniert**.
Mit dem nvidia-utils-Paket und cachyos-settings hast du bereits alles, was du
brauchst, um PRIME Offload zu verwenden.

Bitte vermeide auch die Verwendung von Tools wie optimus-manager. Sie mögen dir
zwar recht nützlich erscheinen, aber glaube uns, sie können eine Menge Probleme
verursachen und du brauchst sie wirklich nicht, wenn deine dGPU PRIME Offload
und dynamisches Energiemanagement unterstützt.

### Wie man PRIME Offload verwendet

Um PRIME mitzuteilen, dass du anstelle der integrierten Grafikkarte die
dedizierte Grafikkarte verwenden möchtest, musst du vor dem Ausführen des
Programms eine Reihe von Umgebungsvariablen angeben:

```bash
__NV_PRIME_RENDER_OFFLOAD=1 __VK_LAYER_NV_optimus=NVIDIA_only __GLX_VENDOR_LIBRARY_NAME=nvidia <Programm>
```

Dieser Satz von Variablen sieht sehr umständlich aus und ist leicht zu
vergessen, daher kannst du das Paket ``nvidia-prime`` installieren (``sudo
pacman -S nvidia-prime``), das ein Skript-Alias für all diese Variablen
enthält. Dann sieht das Ausführen einer Anwendung damit wie folgt aus:

```bash
prime-run <Programm>
```

Wobei ``<Programm>`` der Name des Befehls ist, der deine Anwendung ausführt.

:::note
Einige DX12-Spiele haben Probleme, die dGPU selbst mit `prime-run` auszuwählen.
Um dies zu umgehen, füge die Umgebungsvariable `VK_DRIVER_FILES=/usr/share/vulkan/icd.d/nvidia_icd.json`
vor dem `prime-run`-Wrapper-Skript hinzu.
:::

Für Konfigurationen, bei denen beide Grafikkarten von offenen Mesa-Treibern
verwaltet werden (z. B. AMD+AMD, AMD+Intel oder sogar Intel+NVIDIA, wobei die
dedizierte NVIDIA-Grafikkarte von dem Open-Source-Nouveau-Treiber verwaltet
wird), muss nichts konfiguriert werden, und um die dedizierte Grafikkarte zu
verwenden, musst du nur die Umgebungsvariable ``DRI_PRIME=1`` angeben, bevor du
Anwendungen oder Spiele startest, ähnlich wie alle diese Variablen, die zuvor
für NVIDIA beschrieben wurden, oder die vorgefertigten Grafikmethoden verwenden,
die unten besprochen werden.

## Grafische Methode

Du findest es vielleicht unpraktisch, alle benötigten Anwendungen über das
Terminal mit ``prime-run`` zu starten. Glücklicherweise bieten einige
Anwendungen und Desktop-Umgebungen Tools, um zu steuern, welche GPU für
bestimmte Anwendungen verwendet wird.

### Lutris

Um Spiele so zu konfigurieren, dass sie in Lutris mit dedizierter Grafikkarte
laufen, musst du zu den Einstellungen gehen (drei Streifen in der unteren
rechten Ecke des Fensters und "Einstellungen"-Button). Gehe dann zu *"Globale
Optionen"* -> *"Anzeige"*. Hier kannst du die GPU auswählen, auf der das Spiel
laufen soll.

<br />
<ImageComponent imgsrc={import('~/assets/images/lutris-prime.png')} />

### Steam

Steam hat keine spezielle Einstellung, um ein Spiel zu zwingen, die dedizierte
Grafikkarte zu verwenden. Du kannst jedoch auf die Eigenschaften des Spiels
zugreifen, indem du vor dem Start auf das Zahnradsymbol klickst. Im Feld
"Startoptionen" kannst du den Befehl prime-run oder Umgebungsvariablen
hinzufügen. Beispiel:

```bash
prime-run %command%
```

Achte darauf, ``%command%`` nach ``prime-run`` hinzuzufügen. Denke daran, dass
Spieloptionen nach dem Platzhalter kommen, während Systemumgebungsvariablen oder
Befehle davor stehen sollten.

<br />
<ImageComponent imgsrc={import('~/assets/images/steam-prime.png')} />

### KDE Plasma

Plasma hat eine sehr praktische Möglichkeit, den Start von Anwendungen mit
dedizierter Grafik einzurichten. Diese Methode funktioniert jedoch nur, wenn das
Paket switcheroo-control und der dazugehörige Dienst auf deinem System
installiert sind.

Bei einer Neuinstallation von CachyOS sollten dieses Paket und dieser Dienst
bereits standardmäßig über chwd aktiviert sein.

```bash
sudo pacman -S switcheroo-control
sudo systemctl enable --now switcheroo-control
```

Nachdem du beide Befehle ausgeführt hast, klicke mit der rechten Maustaste auf
den gewünschten Desktop-Eintrag auf deinem Desktop oder im Anwendungsmenü und
gehe dann zu *"Eigenschaften"* -> *"Anwendung"* -> *"Erweiterte Optionen"*.

Du solltest das Kontrollkästchen *"Mit dedizierter Grafikkarte ausführen"*
aktiviert haben.

<br />
<ImageComponent imgsrc={import('~/assets/images/plasma-prime.jpg')} />

:::note
Die Verwendung von switcheroo-control ermöglicht es, dass diese Kontrollkästchen
auf allen PRIME-Konfigurationen funktionieren, die nicht einmal eine NVIDIA dGPU
haben, wie z. B. AMD-APU+AMD-Dedicated.
:::

### GNOME

Unter GNOME solltest du auch switcheroo-control wie oben gezeigt installieren
und mit der rechten Maustaste auf das Anwendungssymbol klicken und *"Mit
dedizierter Grafik ausführen"* auswählen. Beachte jedoch, dass GNOME diese
Auswahl für später nicht speichert und das nächste Mal, wenn du die Anwendung
über das Symbol ausführst, sie mit der integrierten Grafikkarte anstelle der
dedizierten ausgeführt wird.

### Cinnamon

Ähnlich wie Plasma ermöglicht Cinnamon auch die Auswahl der GPU für bestimmte
Anwendungen. Klicke mit der rechten Maustaste auf den Desktop-Eintrag der
Anwendung, gehe zu Eigenschaften und aktiviere die entsprechende Option.

<br />
<ImageComponent imgsrc={import('~/assets/images/cinnamon-prime.png')} />

Wenn es nicht verfügbar ist, stelle sicher, dass du ``switcheroo-control``
installiert und seinen Dienst aktiviert hast, da alle Desktop-Umgebungen für
diese Funktionalität darauf angewiesen sind.

## Fehlerbehebung

### "Mein externer Monitor ist auf PRIME sehr verzögert"

Dies ist ein bekanntes Problem mit dem NVIDIA-Treiber. Du solltest den
neuesten NVIDIA-Treiber installiert haben und Wayland mit einem Compositor
verwenden, der Explicit Sync unterstützt. Für GNOME wurde dies in Version 46.2
behoben. Für Plasma 6 wird es wahrscheinlich mit 6.1 behoben, obwohl einige
Benutzer bereits unter 6.0 eine normale Leistung melden. Andere
Umgebungen/Fenstermanager haben dieses Problem immer noch, daher musst du auf
die neueste Version von GNOME oder Plasma umsteigen, um es zu beheben.
