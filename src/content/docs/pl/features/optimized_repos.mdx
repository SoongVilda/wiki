---
title: Zoptymalizowane Repozytoria
description: Informacje o naszych zoptymalizowanych repozytoriach
---

import { Tabs, TabItem, Steps } from '@astrojs/starlight/components';

Naszym celem jest dostarczenie dystrybucji zoptymalizowanej pod kątem wydajności, co wymaga rekompilacji niezbędnych pakietów Arch Linux dla architektur x86-64-v3, x86-64-v4 i Zen4.

- **x86-64-v3:** 5%-20% wzrostu wydajności w porównaniu do x86-64.
- **x86-64-v4:** Zapewnia znaczące korzyści wydajnościowe dzięki obsłudze AVX512, w zależności od obciążenia.
- **Zen 4/5:** Oprócz zestawu instrukcji x86-64-v4, dodano następujące:

```text
abm, adx, aes, avx512bf16, avx512bitalg, avx512ifma, avx512vbmi, avx512vbmi2, avx512vnni,
avx512vpopctndq, clflushopt, clwb, clzero, fsgsbase, gfni, mwaitx, pclmul, pku, prfchw,
rpdid, rdrnd, rdseed, sha, sse4a, vaes, vockmulqdq, wbnoinvd, savec, xsaveopt, xsaves
```

## Dostosowane pakiety

Nasze repozytorium [CachyOS-PKGBUILDs](https://github.com/CachyOS/CachyOS-PKGBUILDS) zawiera pakiety, które otrzymują bieżące aktualizacje, łatki i poprawki przeniesione z nowszych wersji (backporty).
Aby zwiększyć wydajność, selektywnie wdrażamy optymalizacje PGO, LTO i BOLT w zależności od potrzeb.
Utrzymujemy również kilka pakietów -git, np. mesa-git.

## Dodawanie naszych repozytoriów do istniejącej instalacji Arch Linux

:::caution
Instalacja CachyOS Pacman zainstaluje rozwidloną wersję pacmana z funkcjami dodanymi przez CachyOS, takimi jak "INSTALLED_FROM" i automatyczne sprawdzanie architektury. Pacman 6.1 dodał funkcję walidacji funkcji, co może prowadzić do ostrzeżeń podczas używania pacmana z Arch Linux. Współpracujemy z Arch Linux, aby ponownie zapewnić odpowiednią kompatybilność. Jeśli chcesz tego uniknąć, nie dodawaj repozytorium "cachyos", które zawiera zmodyfikowanego pacmana. Wszystkie inne repozytoria, takie jak cachyos-v3, cachyos-v4, cachyos-extra/core-v3/4, można bezpiecznie dodawać.
:::

:::tip
Przed rozważeniem dodania naszych repozytoriów, prosimy o zapoznanie się z **[listą kompatybilności CPU](/pl/installation/installation_prepare#x86_64-microarchitecture-level-support)**
:::

<Tabs>

<TabItem label='Automatycznie'>

Dostarczamy skrypt, który automatyzuje instalację naszych repozytoriów w istniejących instalacjach opartych na Arch.

```sh
curl https://mirror.cachyos.org/cachyos-repo.tar.xz -o cachyos-repo.tar.xz
tar xvf cachyos-repo.tar.xz && cd cachyos-repo
sudo ./cachyos-repo.sh
```

:::tip[Jak działa skrypt]
Ten skrypt wykryje zestawy instrukcji obsługiwane przez Twój procesor i zainstaluje wersję naszych repozytoriów, która jest dla niego najbardziej zoptymalizowana. Tworzy również kopię zapasową starego pliku `pacman.conf` na potrzeby usunięcia repozytoriów za pomocą skryptu.
:::

</TabItem>

<TabItem label='Ręcznie'>

<Steps>

1. Zainstaluj pęk kluczy CachyOS:

   ```sh
   # Zaimportuj klucz repozytorium
   sudo pacman-key --recv-keys F3B607488DB35A47 --keyserver keyserver.ubuntu.com
   # Podpisz klucz repozytorium
   sudo pacman-key --lsign-key F3B607488DB35A47
   ```
2. Zainstaluj niezbędne pakiety:

   ```sh
   sudo pacman -U 'https://mirror.cachyos.org/repo/x86_64/cachyos/cachyos-keyring-20240331-1-any.pkg.tar.zst' \
   'https://mirror.cachyos.org/repo/x86_64/cachyos/cachyos-mirrorlist-22-1-any.pkg.tar.zst' \
   'https://mirror.cachyos.org/repo/x86_64/cachyos/cachyos-v3-mirrorlist-22-1-any.pkg.tar.zst' \
   'https://mirror.cachyos.org/repo/x86_64/cachyos/cachyos-v4-mirrorlist-22-1-any.pkg.tar.zst' \
   'https://mirror.cachyos.org/repo/x86_64/cachyos/pacman-7.0.0.r6.gc685ae6-3-x86_64.pkg.tar.zst'
   ```
3. Dodaj repozytoria CachyOS do pliku konfiguracyjnego pacmana:
   :::note
   Te repozytoria powinny być umieszczone powyżej repozytoriów Arch Linux.
   :::

   ```shell
   # /etc/pacman.conf
   # Jeśli Twój procesor obsługuje tylko x86-64, dodaj repozytorium [cachyos]
   # repozytoria cachyos
   [cachyos]
   Include = /etc/pacman.d/cachyos-mirrorlist

   # Jeśli Twój procesor obsługuje x86-64-v3, dodaj [cachyos-v3],[cachyos-core-v3],[cachyos-extra-v3] i [cachyos]
   # repozytoria cachyos

   [cachyos-v3]
   Include = /etc/pacman.d/cachyos-v3-mirrorlist
   [cachyos-core-v3]
   Include = /etc/pacman.d/cachyos-v3-mirrorlist
   [cachyos-extra-v3]
   Include = /etc/pacman.d/cachyos-v3-mirrorlist
   [cachyos]
   Include = /etc/pacman.d/cachyos-mirrorlist

   # Jeśli Twój procesor obsługuje x86-64-v4, dodaj [cachyos-v4], [cachyos-core-v4], [cachyos-extra-v4] i [cachyos]
   # repozytoria cachyos

   [cachyos-v4]
   Include = /etc/pacman.d/cachyos-v4-mirrorlist
   [cachyos-core-v4]
   Include = /etc/pacman.d/cachyos-v4-mirrorlist
   [cachyos-extra-v4]
   Include = /etc/pacman.d/cachyos-v4-mirrorlist
   [cachyos]
   Include = /etc/pacman.d/cachyos-mirrorlist

   # Jeśli Twój procesor jest oparty na Zen 4 lub Zen 5, dodaj [cachyos-znver4], [cachyos-core-znver4], [cachyos-extra-znver4] i [cachyos]

   [cachyos-znver4]
   Include = /etc/pacman.d/cachyos-v4-mirrorlist
   [cachyos-core-znver4]
   Include = /etc/pacman.d/cachyos-v4-mirrorlist
   [cachyos-extra-znver4]
   Include = /etc/pacman.d/cachyos-v4-mirrorlist
   [cachyos]
   Include = /etc/pacman.d/cachyos-mirrorlist
   ```
      :::tip
   Aby przejść z repozytoriów `v4` na `znver4`

   Dodaj odpowiednie wpisy z poprzedniego kroku i wykonaj następujące polecenia:
    ```sh
    sudo pacman -Scc # Wpisz T w obu przypadkach
    sudo pacman -Sy
    pacman -Qqn | sudo pacman -S - # Aby zamienić wszystkie pakiety v4 na pakiety znver4
    # Uruchom ponownie system
    ```
   :::

4. Na koniec zaktualizuj system pakietami CachyOS:
   ```sh
   sudo pacman -Syu
   ```

</Steps>

</TabItem>

</Tabs>

### Odinstalowywanie repozytoriów CachyOS

<Tabs>
<TabItem label='Automatycznie'>

**Wykonaj poniższe polecenia, aby usunąć repozytoria CachyOS z systemu:**
```sh
curl https://mirror.cachyos.org/cachyos-repo.tar.xz -o cachyos-repo.tar.xz
tar xvf cachyos-repo.tar.xz
cd cachyos-repo
sudo ./cachyos-repo.sh --remove
```

</TabItem>

<TabItem label='Ręcznie'>

<Steps>

1. Zainstaluj ponownie oryginalnego pacmana z Arch Linux:
   ```sh
   sudo pacman -S core/pacman
   ```
2. Wykonaj następujące polecenie:
   ```sh
   # To pozwala uniknąć ostrzeżeń %INSTALLED_DB%
   sudo find /var/lib/pacman/local/ -type f -name "desc" -exec sed -i '/^%INSTALLED_DB%$/,+2d' {} \;
   ```
3. Przywróć oryginalny plik konfiguracyjny pacmana:
   ```sh
   sudo mv /etc/pacman.conf.bak /etc/pacman.conf
   ```
4. Przełącz się z powrotem na domyślne pakiety Arch Linux za pomocą następujących poleceń:
   ```sh
   pacman -Qqn | sudo pacman -S -
   sudo pacman -Syu
   ```
</Steps>

</TabItem>
</Tabs>

## Testy i benchmarki

Michael z Phoronix już kilkukrotnie testował CachyOS, które w większości przypadków przoduje na wykresach benchmarków oraz w średniej geometrycznej wszystkich wyników testów.
Od pierwszego benchmarku przeprowadzonego w 2022 roku, CachyOS znacznie ewoluowało i dojrzało pod względem użyteczności i wydajności.

Jeśli chcesz dowiedzieć się więcej o wzroście wydajności dzięki naszym repozytoriom, sprawdź poniższe linki.

* **14/03/2021:** W dyskusji RFC na temat wpływu x86-64-v3, zainicjowanej przez **Mateusza Jończyka** z Arch Linux, przedstawiono wstępne wyniki.
  * [RFC: Use x86_64-v2 architecture](https://lists.archlinux.org/pipermail/arch-general/2021-March/048739.html)

* **09/12/2022:** Pierwszy benchmark przeprowadzony przez Michaela.
  * [The Performance Of Arch Linux Powered CachyOS](https://www.phoronix.com/review/cachyos-linux-perf)

* **29/02/2024:** Phoronix przeprowadził kolejny benchmark pokazujący różnicę między pakietami x86-64-v4, x86-64-v3 i x86-64 (ogólnymi). Patrząc na przykłady takie jak PHP czy GCC, gdzie dostosowujemy nasze PKGBUILDy, widać zauważalną poprawę wydajności.
  * [Arch Linux CachyOS Benchmarks Of x86-64-v3 & x86-64-v4 Repositories](https://www.phoronix.com/review/cachyos-x86-64-v3-v4)

* **20/08/2024:** Michael opublikował nowy benchmark dla AMD Ryzen 9950x, który obejmuje CachyOS i inne dystrybucje Linuksa.
  * [Intel Continues To Show AMD The Importance Of Software Optimizations: 16% More Ryzen 9 9950X Performance](https://www.phoronix.com/review/linux-os-amd-ryzen9-9950x)
   :::note
   Liquid-DSP i RocksDB zostały skompilowane przy użyciu Phoronix Benchmark Suite, ignorując flagi kompilacji określone w /etc/makepkg.conf, co spowodowało nieoczekiwany wynik wydajności dla CachyOS.
   :::

## Dowiedz się więcej

- [Zestawy instrukcji dla różnych mikroarchitektur x86-64](https://en.wikipedia.org/wiki/X86-64#Microarchitecture_levels)
